<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Unit 4 – For a Better Community</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-blue-50 text-gray-800;
        }
        .quiz-container {
            @apply bg-white p-8 rounded-xl shadow-lg max-w-2xl w-full mx-auto my-10;
        }
        .question-text {
            @apply text-xl font-semibold mb-6 text-blue-800;
        }
        .answer-option {
            @apply flex items-center mb-4 p-4 border border-blue-200 rounded-lg cursor-pointer transition-all duration-200;
        }
        .answer-option:hover {
            @apply bg-blue-50 border-blue-300;
        }
        .answer-option.selected {
            @apply bg-blue-100 border-blue-500 ring-2 ring-blue-500;
        }
        .answer-option input[type="radio"] {
            @apply mr-3;
        }
        .feedback-box {
            @apply mt-4 p-4 rounded-lg text-sm;
        }
        .feedback-correct {
            @apply bg-green-100 text-green-800 border border-green-300;
        }
        .feedback-incorrect {
            @apply bg-red-100 text-red-800 border border-red-300;
        }
        .quiz-navigation button {
            @apply px-6 py-3 rounded-lg font-semibold transition-all duration-200;
        }
        .quiz-navigation button.primary {
            @apply bg-blue-600 text-white hover:bg-blue-700 shadow-md;
        }
        .quiz-navigation button.secondary {
            @apply bg-gray-200 text-gray-700 hover:bg-gray-300;
        }
        .hint-button {
            @apply text-blue-500 hover:text-blue-700 font-medium text-sm mt-2;
        }
        .hint-text {
            @apply bg-yellow-50 text-yellow-800 p-3 rounded-lg text-sm mt-3 border border-yellow-200;
        }
        .results-container {
            @apply text-center mt-8;
        }
        .results-score {
            @apply text-3xl font-bold text-blue-700 mb-4;
        }
        .results-details {
            @apply text-lg;
        }
        .restart-button {
            @apply mt-6 bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 shadow-md;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="quiz-container">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-900">Quiz: Unit 4 – For a Better Community</h1>

        <!-- Question Section -->
        <div id="quiz-question-section">
            <p class="text-lg mb-2"><span id="question-number" class="font-semibold text-blue-600"></span> / <span id="total-questions"></span></p>
            <h2 id="question-text" class="question-text"></h2>
            <div id="answer-options" class="flex flex-col gap-3">
                <!-- Answer options will be injected here by JavaScript -->
            </div>
            <button id="show-hint-button" class="hint-button block mx-auto">Hiển thị gợi ý</button>
            <p id="hint-text" class="hint-text hidden"></p>
            <div id="feedback-area" class="feedback-box hidden"></div>
            <div class="quiz-navigation flex justify-between mt-8">
                <button id="prev-button" class="secondary" disabled>Câu trước</button>
                <button id="next-button" class="primary">Câu tiếp theo</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="quiz-results-section" class="results-container hidden">
            <h2 class="text-3xl font-bold text-blue-800 mb-4">Kết quả Quiz</h2>
            <p class="results-score">Bạn đã đạt: <span id="final-score">0</span> / <span id="total-score-max"></span></p>
            <p id="results-message" class="results-details"></p>
            <button id="restart-button" class="restart-button">Làm lại Quiz</button>
        </div>
    </div>

    <script>
        // Quiz data containing all questions, options, hints, and rationales
        const quizData = {
          "questions": [
            {
              "question": "Imagine you want to help clean up a local park. Which term from the lesson best describes this type of community service activity?",
              "answerOptions": [
                {
                  "text": "Fundraising",
                  "rationale": "Fundraising involves collecting money, not physically cleaning an area.",
                  "isCorrect": false
                },
                {
                  "text": "Environmental protection",
                  "rationale": "While related to environmental protection, 'clean-up campaign' is a more specific activity mentioned in the lesson.",
                  "isCorrect": false
                },
                {
                  "text": "A clean-up campaign",
                  "rationale": "This term directly refers to organized efforts to remove trash and tidy an area, which aligns with cleaning a park.",
                  "isCorrect": true
                },
                {
                  "text": "Charity work",
                  "rationale": "Charity work is a broader term; 'clean-up campaign' is a more precise description of the specific activity.",
                  "isCorrect": false
                }
              ],
              "hint": "Consider the activity that involves physically improving an outdoor space."
            },
            {
              "question": "According to the lesson, what is a key benefit for **volunteers themselves** when participating in community work?",
              "answerOptions": [
                {
                  "text": "Cleaner streets in the neighborhood",
                  "rationale": "This is a benefit for the community as a whole, not directly for the individual volunteer.",
                  "isCorrect": false
                },
                {
                  "text": "Receiving academic credits for school",
                  "rationale": "The lesson plan focuses on personal development and awareness, not academic incentives.",
                  "isCorrect": false
                },
                {
                  "text": "Developing a sense of responsibility",
                  "rationale": "Volunteering often fosters personal growth, including a stronger sense of duty and empathy.",
                  "isCorrect": true
                },
                {
                  "text": "Financial compensation for their time",
                  "rationale": "Volunteering is defined as giving time freely without payment.",
                  "isCorrect": false
                }
              ],
              "hint": "Think about the internal, personal growth aspect of giving back."
            },
            {
              "question": "When presenting a 'Group Project Pitch', which component outlines *how* your project will be carried out?",
              "answerOptions": [
                {
                  "text": "Project Name",
                  "rationale": "The project name identifies it, but doesn't explain the execution steps.",
                  "isCorrect": false
                },
                {
                  "text": "Target Group",
                  "rationale": "The target group identifies *who* is being helped, not the method of help.",
                  "isCorrect": false
                },
                {
                  "text": "Expected Results",
                  "rationale": "Expected results describe the anticipated outcomes, not the process.",
                  "isCorrect": false
                },
                {
                  "text": "Plan of Action",
                  "rationale": "The 'Plan of Action' specifically details the steps, activities, and strategies for achieving the project's goals.",
                  "isCorrect": true
                }
              ],
              "hint": "Consider the section where you would list the specific steps and methods of implementation."
            },
            {
              "question": "During the 'Pre-speaking' activity, students brainstorm reasons for volunteering. What is one of the linking words highlighted by the teacher for expressing reasons?",
              "answerOptions": [
                {
                  "text": "However",
                  "rationale": "This word is used for contrast, not typically for listing reasons or adding points.",
                  "isCorrect": false
                },
                {
                  "text": "As a result",
                  "rationale": "This phrase introduces a consequence or outcome, which is relevant to benefits, but not directly a reason-introducing linking word in the context of brainstorming initial reasons.",
                  "isCorrect": true
                },
                {
                  "text": "Despite",
                  "rationale": "This word is used to introduce a contrasting element or concession.",
                  "isCorrect": false
                },
                {
                  "text": "Therefore",
                  "rationale": "This word indicates a conclusion or deduction, not a way to add a reason.",
                  "isCorrect": false
                }
              ],
              "hint": "Recall the phrases used to connect ideas when listing multiple reasons or benefits."
            },
            {
              "question": "Which of the following vocabulary words is most suitable for describing someone who helps children with their studies at a local center without getting paid?",
              "answerOptions": [
                {
                  "text": "Orphanage",
                  "rationale": "An orphanage is a place, not a person or type of volunteer.",
                  "isCorrect": false
                },
                {
                  "text": "Tutor",
                  "rationale": "A tutor is someone who provides academic instruction, fitting the description of helping with studies.",
                  "isCorrect": true
                },
                {
                  "text": "Fundraiser",
                  "rationale": "A fundraiser focuses on collecting money, not on teaching.",
                  "isCorrect": false
                },
                {
                  "text": "Beneficiary",
                  "rationale": "A beneficiary is someone who receives help, not someone who gives it.",
                  "isCorrect": false
                }
              ],
              "hint": "Think about the specific role of helping someone learn or understand subjects."
            },
            {
              "question": "If students are asked 'Who would you help?' during the pair discussion, what kind of information are they expected to provide?",
              "answerOptions": [
                {
                  "text": "The location of the community service",
                  "rationale": "This question focuses on the recipients of the help, not the geographical place.",
                  "isCorrect": false
                },
                {
                  "text": "The type of activity to be performed",
                  "rationale": "This addresses 'what' activity, not 'who' will benefit.",
                  "isCorrect": false
                },
                {
                  "text": "The group or individuals who will receive assistance",
                  "rationale": "This directly answers the 'who' aspect of community service.",
                  "isCorrect": true
                },
                {
                  "text": "The duration of the volunteering project",
                  "rationale": "This refers to the timeline or length, not the beneficiaries.",
                  "isCorrect": false
                }
              ],
              "hint": "This question aims to identify the recipients or beneficiaries of the volunteering effort."
            },
            {
              "question": "In the assessment criteria for speaking, what does 'Fluency' primarily assess?",
              "answerOptions": [
                {
                  "text": "The variety of vocabulary used",
                  "rationale": "This criterion specifically refers to 'Vocabulary range', not fluency.",
                  "isCorrect": false
                },
                {
                  "text": "The clarity of pronunciation",
                  "rationale": "This criterion refers to 'Pronunciation', not fluency.",
                  "isCorrect": false
                },
                {
                  "text": "Responding appropriately to partners",
                  "rationale": "This refers to 'Interaction', not fluency.",
                  "isCorrect": false
                },
                {
                  "text": "Speaking smoothly without long pauses",
                  "rationale": "Fluency in speaking is about the natural flow and rhythm of speech, minimizing hesitations.",
                  "isCorrect": true
                }
              ],
              "hint": "Consider the aspect of speech that relates to its natural flow and rhythm."
            },
            {
              "question": "What is the main objective related to 'Attitudes' for students by the end of this lesson?",
              "answerOptions": [
                {
                  "text": "To memorize new vocabulary words",
                  "rationale": "This falls under 'Knowledge' objectives, not 'Attitudes'.",
                  "isCorrect": false
                },
                {
                  "text": "To develop public speaking skills",
                  "rationale": "This is a 'Skill' objective, specifically related to fluency and clarity in presentation.",
                  "isCorrect": false
                },
                {
                  "text": "To raise awareness of the importance of community work",
                  "rationale": "Attitude objectives typically involve fostering appreciation, awareness, or willingness towards a topic.",
                  "isCorrect": true
                },
                {
                  "text": "To complete homework assignments on time",
                  "rationale": "This is a general classroom expectation, not a specific lesson objective for attitudes.",
                  "isCorrect": false
                }
              ],
              "hint": "Look at the 'Objectives' section and specifically the 'Attitudes' point."
            },
            {
              "question": "During the 'Warm-up: Picture Guessing' activity, what is the teacher's purpose in eliciting answers and writing vocabulary on the board?",
              "answerOptions": [
                {
                  "text": "To assign roles for the group project",
                  "rationale": "The warm-up focuses on vocabulary activation, not project assignments.",
                  "isCorrect": false
                },
                {
                  "text": "To assess students' prior knowledge before teaching",
                  "rationale": "While it activates prior knowledge, the main stated purpose is vocabulary activation, not formal assessment.",
                  "isCorrect": false
                },
                {
                  "text": "To activate background knowledge and vocabulary",
                  "rationale": "This directly aligns with the stated purpose of the warm-up activity in the lesson plan.",
                  "isCorrect": true
                },
                {
                  "text": "To begin the main pair discussion task",
                  "rationale": "The main pair discussion happens later in the 'While-speaking' phase.",
                  "isCorrect": false
                }
              ],
              "hint": "Refer to the 'Purpose' section of the Warm-up activity in the lesson plan."
            },
            {
              "question": "After the 'Class Vote' activity in the Post-speaking phase, what is one of the points the teacher summarizes for the students?",
              "answerOptions": [
                {
                  "text": "New grammar rules to study for homework",
                  "rationale": "The summary focuses on speaking performance and engagement, not new grammar rules for homework.",
                  "isCorrect": false
                },
                {
                  "text": "Common mistakes to avoid in future discussions",
                  "rationale": "The lesson plan explicitly mentions that the teacher summarizes 'common mistakes to avoid' during this phase.",
                  "isCorrect": true
                },
                {
                  "text": "The next unit's topic for their upcoming test",
                  "rationale": "The homework section mentions preparing for the next lesson (Listening), but the summary itself focuses on performance in the current speaking lesson.",
                  "isCorrect": false
                },
                {
                  "text": "Individual scores for fluency and pronunciation",
                  "rationale": "Feedback is given, but the summary is for the whole class and focuses on general points, not individual scores.",
                  "isCorrect": false
                }
              ],
              "hint": "Look at the 'Post-speaking / Consolidation' section and what the teacher summarizes."
            }
          ]
        };

        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = []; // To store user's selected answers for review/restart
        let hasAnsweredCurrentQuestion = false;

        // Get DOM elements
        const quizQuestionSection = document.getElementById('quiz-question-section');
        const quizResultsSection = document.getElementById('quiz-results-section');
        const questionNumberSpan = document.getElementById('question-number');
        const totalQuestionsSpan = document.getElementById('total-questions');
        const questionTextElement = document.getElementById('question-text');
        const answerOptionsContainer = document.getElementById('answer-options');
        const showHintButton = document.getElementById('show-hint-button');
        const hintTextElement = document.getElementById('hint-text');
        const feedbackArea = document.getElementById('feedback-area');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const finalScoreSpan = document.getElementById('final-score');
        const totalScoreMaxSpan = document.getElementById('total-score-max');
        const resultsMessage = document.getElementById('results-message');
        const restartButton = document.getElementById('restart-button');

        // Set total questions display
        totalQuestionsSpan.textContent = quizData.questions.length;
        totalScoreMaxSpan.textContent = quizData.questions.length;

        // Function to load a question
        function loadQuestion() {
            // Clear previous feedback and hint
            feedbackArea.classList.add('hidden');
            feedbackArea.textContent = '';
            hintTextElement.classList.add('hidden');
            showHintButton.classList.remove('hidden'); // Show hint button for new question

            const question = quizData.questions[currentQuestionIndex];
            questionNumberSpan.textContent = currentQuestionIndex + 1;
            questionTextElement.textContent = question.question;
            answerOptionsContainer.innerHTML = ''; // Clear previous options

            // Shuffle answer options to ensure they are not always in the same order
            const shuffledOptions = [...question.answerOptions].sort(() => Math.random() - 0.5);

            shuffledOptions.forEach((option, index) => {
                const optionDiv = document.createElement('label');
                optionDiv.className = 'answer-option';
                optionDiv.innerHTML = `
                    <input type="radio" name="answer" value="${index}" class="form-radio text-blue-600 h-5 w-5">
                    <span>${option.text}</span>
                `;
                // Attach event listener to handle answer selection
                optionDiv.addEventListener('click', () => selectAnswer(option, optionDiv));
                answerOptionsContainer.appendChild(optionDiv);
            });

            // Update navigation buttons text and state
            prevButton.disabled = currentQuestionIndex === 0; // Disable 'Previous' on the first question
            nextButton.textContent = currentQuestionIndex === quizData.questions.length - 1 ? 'Hoàn thành Quiz' : 'Câu tiếp theo';

            // Check if user has answered this question before and restore selection/feedback
            hasAnsweredCurrentQuestion = userAnswers[currentQuestionIndex] !== undefined;
            if (hasAnsweredCurrentQuestion) {
                // Find the radio button corresponding to the previously selected answer
                const selectedOptionValue = userAnswers[currentQuestionIndex].selectedOptionIndex;
                const selectedRadioButton = answerOptionsContainer.querySelector(`input[type="radio"][value="${selectedOptionValue}"]`);
                if (selectedRadioButton) {
                    selectedRadioButton.checked = true; // Mark as checked
                    // Visually mark selected option
                    const selectedLabel = selectedRadioButton.closest('.answer-option');
                    selectedLabel.classList.add('selected');

                    // Show feedback immediately if already answered
                    // We need the original option data to get the rationale and correctness
                    const selectedOptionData = quizData.questions[currentQuestionIndex].answerOptions[userAnswers[currentQuestionIndex].originalOptionIndex];
                    displayFeedback(selectedOptionData.rationale, selectedOptionData.isCorrect);

                    // Disable further changes to answers for this question
                    answerOptionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
                }
            } else {
                 // Enable radio buttons if not yet answered for this question
                answerOptionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = false);
            }
        }

        // Function to handle answer selection
        function selectAnswer(selectedOptionData, selectedOptionDiv) {
            if (hasAnsweredCurrentQuestion) return; // Prevent changing answer if already answered

            // Remove 'selected' class from all options
            answerOptionsContainer.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('selected');
            });
            // Add 'selected' class to the clicked option
            selectedOptionDiv.classList.add('selected');

            // Find the original index of the selected option in the unshuffled array
            // This is important because the 'value' of the radio button is based on the shuffled index
            // but we need to store the 'original' index to correctly retrieve rationale and isCorrect later
            const originalOptionIndex = quizData.questions[currentQuestionIndex].answerOptions.findIndex(
                option => option.text === selectedOptionData.text
            );

            // Store user's answer
            userAnswers[currentQuestionIndex] = {
                selectedOptionIndex: selectedOptionDiv.querySelector('input').value, // Index based on shuffled options
                originalOptionIndex: originalOptionIndex, // Original index in quizData.questions[currentQuestionIndex].answerOptions
                isCorrect: selectedOptionData.isCorrect
            };

            // Display feedback for the selected answer
            displayFeedback(selectedOptionData.rationale, selectedOptionData.isCorrect);

            // Disable all radio buttons for the current question after an answer is selected
            answerOptionsContainer.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
            hasAnsweredCurrentQuestion = true; // Mark question as answered
        }

        // Function to display feedback message
        function displayFeedback(rationale, isCorrect) {
            feedbackArea.classList.remove('hidden', 'feedback-correct', 'feedback-incorrect');
            feedbackArea.textContent = rationale;
            if (isCorrect) {
                feedbackArea.classList.add('feedback-correct');
            } else {
                feedbackArea.classList.add('feedback-incorrect');
            }
        }

        // Event listener for showing hint
        showHintButton.addEventListener('click', () => {
            hintTextElement.textContent = quizData.questions[currentQuestionIndex].hint;
            hintTextElement.classList.remove('hidden');
            showHintButton.classList.add('hidden'); // Hide hint button after showing hint
        });

        // Event listener for 'Next' button
        nextButton.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                // If it's the last question and 'Next' is clicked, end the quiz
                calculateScore();
                showResults();
            }
        });

        // Event listener for 'Previous' button
        prevButton.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        });

        // Function to calculate final score
        function calculateScore() {
            score = 0;
            userAnswers.forEach(answer => {
                // Ensure the answer exists and was marked as correct
                if (answer && answer.isCorrect) {
                    score++;
                }
            });
        }

        // Function to show quiz results
        function showResults() {
            quizQuestionSection.classList.add('hidden'); // Hide question section
            quizResultsSection.classList.remove('hidden'); // Show results section
            finalScoreSpan.textContent = score; // Display final score

            // Provide a personalized message based on the score
            let message = '';
            const percentage = (score / quizData.questions.length) * 100;
            if (percentage === 100) {
                message = "Xuất sắc! Bạn đã trả lời đúng tất cả các câu hỏi.";
            } else if (percentage >= 70) {
                message = "Rất tốt! Bạn có kiến thức vững chắc về chủ đề này.";
            } else if (percentage >= 50) {
                message = "Khá tốt! Hãy ôn lại một chút để cải thiện nhé.";
            } else {
                message = "Tiếp tục cố gắng! Bạn có thể xem lại bài học để hiểu rõ hơn.";
            }
            resultsMessage.textContent = message;
        }

        // Event listener for 'Restart Quiz' button
        restartButton.addEventListener('click', () => {
            currentQuestionIndex = 0; // Reset to first question
            score = 0; // Reset score
            userAnswers = []; // Clear all previous answers
            quizResultsSection.classList.add('hidden'); // Hide results
            quizQuestionSection.classList.remove('hidden'); // Show quiz questions again
            loadQuestion(); // Load the first question to start fresh
        });

        // Initialize quiz when the page loads
        loadQuestion();
    </script>
</body>
</html>
